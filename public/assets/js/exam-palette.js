(function(){ const questions = Array.from(document.querySelectorAll('.card.mb-2')); const palette = document.getElementById('qPalette'); if(!palette || questions.length===0) return; const stateKey = 'cbt_q_states_' + (document.querySelector('input[name="exam_id"]')?.value || 'unknown'); let states = JSON.parse(localStorage.getItem(stateKey) || '[]'); if(states.length === 0 || states.length !== questions.length){ states = Array.from(questions, ()=>0); localStorage.setItem(stateKey, JSON.stringify(states)); } function renderPalette(){ palette.innerHTML = ''; states.forEach((s, idx)=>{ const el = document.createElement('div'); el.className = 'q-pill ' + (s===0 ? 'state-notvisited' : (s===1 ? 'state-answered' : 'state-review')); el.textContent = idx+1; el.dataset.idx = idx; el.title = 'Question ' + (idx+1); el.addEventListener('click', ()=> questions[idx].scrollIntoView({behavior:'smooth', block:'center'})); palette.appendChild(el); }); } function updateState(idx, newState){ states[idx]=newState; localStorage.setItem(stateKey, JSON.stringify(states)); renderPalette(); } questions.forEach((qCard, i)=>{ qCard.querySelectorAll('input[type="radio"]').forEach(r=> r.addEventListener('change', ()=> updateState(i,1))); const markBtn = qCard.querySelector('.mark-review'); if(markBtn) markBtn.addEventListener('click', ()=> updateState(i,2)); }); renderPalette(); document.getElementById('examForm')?.addEventListener('submit', ()=> localStorage.removeItem(stateKey)); })();
